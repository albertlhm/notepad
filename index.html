<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Notebook ‚Äî Notebook</title>
  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #0f172a;
      --text-secondary: #475569;
      --muted: #64748b;
      --accent: #7c3aed;
      --accent-light: #a78bfa;
      --border: #e2e8f0;
      --shadow: rgba(15, 23, 42, 0.08);
      --danger: #ef4444;
      --success: #10b981;
      --warning: #f59e0b;
      --info: #3b82f6;
      
      --font-weight-normal: 450;
      --font-weight-medium: 550;
      --font-weight-bold: 650;
      --font-weight-heavy: 700;
      
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 12px;
    }
    
    [data-theme="dark"] {
      --bg: #0f172a;
      --card: #1e293b;
      --text: #f8fafc;
      --text-secondary: #cbd5e1;
      --muted: #94a3b8;
      --accent: #8b5cf6;
      --accent-light: #a78bfa;
      --border: #334155;
      --shadow: rgba(2, 6, 23, 0.3);
      --danger: #f87171;
      --success: #34d399;
      --warning: #fbbf24;
      --info: #60a5fa;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: Inter, "PingFang SC", "Noto Sans", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 0;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      transition: background 0.4s ease, color 0.4s ease;
      font-weight: var(--font-weight-normal);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    .app {
      max-width: 1080px;
      margin: 28px auto;
      padding: 20px;
    }
    
    header {
      display: flex;
      gap: 16px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }
    
    .brand {
      display: flex;
      gap: 16px;
      align-items: center;
    }
    
    .logo {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--accent), #4f46e5);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: var(--font-weight-heavy);
      font-size: 20px;
      box-shadow: 0 8px 24px rgba(124, 58, 237, 0.3);
      transition: transform 0.3s ease;
    }
    
    .logo:hover {
      transform: scale(1.05);
    }
    
    h1 {
      margin: 0;
      font-size: 20px;
      font-weight: var(--font-weight-bold);
      background: linear-gradient(135deg, var(--accent), #4f46e5);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .btn {
      background: var(--card);
      border: 1px solid var(--border);
      padding: 10px 16px;
      border-radius: var(--radius-md);
      cursor: pointer;
      box-shadow: 0 4px 12px var(--shadow);
      transition: all 0.3s ease;
      font-weight: var(--font-weight-medium);
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .btn:hover {
      background: var(--accent);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(124, 58, 237, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn-danger {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      border-color: rgba(239, 68, 68, 0.2);
    }
    
    .btn-danger:hover {
      background: var(--danger);
      color: white;
    }
    
    .btn-warning {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
      border-color: rgba(245, 158, 11, 0.2);
    }
    
    .btn-warning:hover {
      background: var(--warning);
      color: white;
    }
    
    .btn-success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
      border-color: rgba(16, 185, 129, 0.2);
    }
    
    .btn-success:hover {
      background: var(--success);
      color: white;
    }
    
    .btn-info {
      background: rgba(59, 130, 246, 0.1);
      color: var(--info);
      border-color: rgba(59, 130, 246, 0.2);
    }
    
    .btn-info:hover {
      background: var(--info);
      color: white;
    }
    
    .search {
      flex: 1;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .topbar {
      display: flex;
      gap: 16px;
      margin-top: 16px;
      align-items: center;
    }
    
    .timecard {
      padding: 16px;
      border-radius: var(--radius-lg);
      background: var(--card);
      box-shadow: 0 6px 18px var(--shadow);
      min-width: 240px;
      border: 1px solid var(--border);
    }
    
    .timebig {
      font-weight: var(--font-weight-heavy);
      font-size: 18px;
      margin-bottom: 4px;
      color: var(--text);
    }
    
    .lunar {
      font-size: 14px;
      color: var(--muted);
      font-weight: var(--font-weight-normal);
    }
    
    main {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 24px;
      margin-top: 24px;
    }
    
    .left {
      min-height: 200px;
    }
    
    .noteEditor {
      background: var(--card);
      padding: 20px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      box-shadow: 0 6px 18px var(--shadow);
      margin-bottom: 24px;
    }
    
    .noteEditor input,
    .noteEditor textarea {
      width: 100%;
      padding: 12px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      margin-bottom: 12px;
      background: transparent;
      color: var(--text);
      font-weight: var(--font-weight-normal);
      transition: all 0.3s ease;
      font-size: 15px;
    }
    
    .noteEditor input:focus,
    .noteEditor textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
    }
    
    .noteEditor input::placeholder,
    .noteEditor textarea::placeholder {
      color: var(--muted);
      font-weight: var(--font-weight-normal);
    }
    
    .noteList {
      margin-top: 14px;
      display: grid;
      gap: 14px;
    }
    
    .note {
      background: var(--card);
      padding: 18px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      box-shadow: 0 4px 12px var(--shadow);
      transition: all 0.3s ease;
    }
    
    .note:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px var(--shadow);
    }
    
    .meta {
      font-size: 13px;
      color: var(--muted);
      display: flex;
      gap: 10px;
      align-items: center;
      font-weight: var(--font-weight-normal);
    }
    
    .pill {
      background: rgba(0, 0, 0, 0.06);
      padding: 6px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: var(--font-weight-medium);
    }
    
    aside {
      position: sticky;
      top: 22px;
      height: fit-content;
    }
    
    .reminderList {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 14px;
    }
    
    .reminderTime {
      color: var(--accent);
      font-weight: var(--font-weight-bold);
      animation: pulse 2s infinite ease-in-out;
    }
    
    .reminderAlert {
      color: var(--danger);
      font-weight: var(--font-weight-bold);
      animation: alertPulse 1s infinite ease-in-out;
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: .8;
      }
      50% {
        opacity: 1;
      }
    }
    
    @keyframes alertPulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }
    
    footer {
      opacity: 0.8;
      font-size: 14px;
      margin-top: 28px;
      color: var(--muted);
      font-weight: var(--font-weight-normal);
      text-align: center;
      padding: 16px;
    }
    
    @media (max-width: 900px) {
      main {
        grid-template-columns: 1fr;
      }
      aside {
        position: static;
      }
    }
    
    .note,
    .timecard,
    .noteEditor {
      transition: all 220ms cubic-bezier(.2, .9, .2, 1);
    }
    
    .note.done {
      opacity: 0.7;
      border-left: 4px solid var(--accent);
    }
    
    .note.done .note-title {
      text-decoration: line-through;
    }
    
    .reminder-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      border-radius: var(--radius-md);
      background: rgba(0, 0, 0, 0.04);
      border: 1px solid var(--border);
      transition: all 0.3s ease;
    }
    
    .reminder-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--shadow);
    }
    
    .reminder-item.alert {
      background: rgba(239, 68, 68, 0.1);
      border-left: 4px solid var(--danger);
    }
    
    .reminder-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent);
    }
    
    .reminder-indicator.alert {
      background: var(--danger);
      animation: alertPulse 1s infinite;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
    }
    
    .empty-state svg {
      width: 64px;
      height: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    .file-input {
      display: none;
    }
    
    .import-export {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .stats {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }
    
    .stat {
      flex: 1;
      text-align: center;
      padding: 12px;
      background: var(--card);
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
    }
    
    .stat-value {
      font-size: 20px;
      font-weight: var(--font-weight-bold);
      color: var(--accent);
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: var(--card);
      padding: 24px;
      border-radius: var(--radius-lg);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      width: 90%;
      max-width: 500px;
      border: 1px solid var(--border);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .modal-title {
      font-weight: var(--font-weight-bold);
      font-size: 18px;
      color: var(--text);
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: var(--font-weight-medium);
      color: var(--text);
    }
    
    .form-control {
      width: 100%;
      padding: 10px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      font-size: 15px;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
    }
    
    /* Êñ∞Â¢ûÊ†∑ÂºèÔºöÂ∑≤ÂÆåÊàêÁ¨îËÆ∞Âå∫Âüü */
    .completed-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }
    
    .section-title {
      font-size: 16px;
      font-weight: var(--font-weight-bold);
      margin-bottom: 12px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .section-title::before {
      content: '';
      display: block;
      width: 4px;
      height: 16px;
      background: var(--accent);
      border-radius: 2px;
    }
    
    .completed-notes {
      display: grid;
      gap: 12px;
    }
    
    .completed-note {
      background: var(--card);
      padding: 16px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      opacity: 0.7;
      transition: all 0.3s ease;
    }
    
    .completed-note:hover {
      opacity: 1;
      transform: translateY(-2px);
    }
    
    .completed-note .note-title {
      text-decoration: line-through;
    }
    
    /* Base64 Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
    .base64-modal textarea {
      width: 100%;
      min-height: 200px;
      padding: 12px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      font-family: monospace;
      font-size: 14px;
      resize: vertical;
    }
    
    .base64-modal textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
    }
    
    .base64-actions {
      display: flex;
      gap: 10px;
      margin-top: 16px;
      justify-content: flex-end;
    }
    
    .copy-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: var(--font-weight-medium);
      transition: all 0.3s ease;
    }
    
    .copy-btn:hover {
      background: var(--accent-light);
      transform: translateY(-2px);
    }
    
    /* Base64 Êìç‰ΩúÈÄâÊã©Ê†∑Âºè */
    .base64-mode-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 16px;
    }
    
    .mode-btn {
      flex: 1;
      padding: 12px;
      text-align: center;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: var(--font-weight-medium);
      transition: all 0.3s ease;
    }
    
    .mode-btn.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    .mode-btn:hover:not(.active) {
      background: rgba(124, 58, 237, 0.1);
      border-color: var(--accent);
    }
    
    .base64-section {
      display: none;
    }
    
    .base64-section.active {
      display: block;
    }
    
    .export-info {
      font-size: 12px;
      color: var(--muted);
      margin-top: 8px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="app" id="app" data-lang="en" data-theme="light">
    <header>
      <div class="brand">
        <div class="logo">Á¨î</div>
        <div>
          <h1 data-t="title">Simple Notebook</h1>
          <div style="font-size:14px;color:var(--muted)" data-t="subtitle">Lightweight ¬∑ Search ¬∑ Reminders ¬∑ Lang & Darkmode</div>
        </div>
      </div>
      <div class="controls">
        <div class="search btn" style="min-width:280px;display:flex;align-items:center;">
          <input id="q" placeholder="Search notes" style="flex:1;border:0;background:transparent;outline:none;font-size:14px;color:var(--text)" />
          <button class="btn" id="clear">Clear</button>
        </div>
        <div class="btn" id="lang">‰∏≠Êñá</div>
        <div class="btn" id="theme">üåô</div>
      </div>
    </header>
    <div class="topbar">
      <div class="timecard">
        <div class="timebig" id="datetime">--</div>
        <div class="lunar" id="lunar">Lunar: --</div>
      </div>
      <div style="flex:1"></div>
      <div style="display:flex;gap:10px;align-items:center">
        <div class="btn" id="newNote">New Note</div>
        <div class="btn" id="export">Export Data</div>
        <div class="btn" id="import">Import Data</div>
        <div class="btn" id="base64Data">Base64 Data</div>
        <input type="file" id="fileInput" class="file-input" accept=".json" />
      </div>
    </div>
    <main>
      <section class="left">
        <div class="noteEditor" id="editor">
          <input id="title" placeholder="Title" />
          <textarea id="content" rows="6" placeholder="Write something..."></textarea>
          <div style="display:flex;gap:10px;align-items:center">
            <input id="remindAt" type="datetime-local" style="padding:10px;border-radius:var(--radius-md);border:1px solid var(--border);background:transparent;color:var(--text)" />
            <button class="btn" id="save">Save</button>
            <div style="flex:1"></div>
            <div style="font-size:13px;color:var(--muted)" data-t="help">Each note stores creation date. Set reminders.</div>
          </div>
        </div>
        <div class="stats">
          <div class="stat">
            <div class="stat-value" id="totalNotes">0</div>
            <div class="stat-label">Total Notes</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="activeReminders">0</div>
            <div class="stat-label">Active Reminders</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="completedNotes">0</div>
            <div class="stat-label">Completed</div>
          </div>
        </div>
        <div class="noteList" id="notes"></div>
        <!-- Êñ∞Â¢ûÂ∑≤ÂÆåÊàêÁ¨îËÆ∞Âå∫Âüü -->
        <div class="completed-section" id="completedSection" style="display:none">
          <div class="section-title" data-t="completedNotes">Completed Notes</div>
          <div class="completed-notes" id="completedNotesList"></div>
        </div>
      </section>
      <aside>
        <div style="background:var(--card);padding:16px;border-radius:var(--radius-lg);border:1px solid var(--border);box-shadow:0 4px 12px var(--shadow)">
          <div style="font-weight:700;font-size:16px;margin-bottom:8px" data-t="remindersTitle">Reminders</div>
          <div class="reminderList" id="reminders"></div>
        </div>
        <div style="background:var(--card);padding:16px;border-radius:var(--radius-lg);border:1px solid var(--border);box-shadow:0 4px 12px var(--shadow);margin-top:16px">
          <div style="font-weight:700;font-size:16px;margin-bottom:8px" data-t="infoTitle">Info</div>
          <div style="color:var(--muted);font-size:14px;margin-top:8px" data-t="infoText">Supports local storage. Reminders are checked when page opens and use desktop notifications (requires permission).</div>
          <div style="color:var(--muted);font-size:12px;margin-top:8px;padding:8px;background:rgba(0,0,0,0.05);border-radius:var(--radius-md)">
            üí° <span data-t="notificationTip">Tip: First time setting a reminder will request notification permission, please allow browser to send desktop notifications</span>
          </div>
        </div>
      </aside>
    </main>
    <footer data-t="footer">Simple Notebook ‚Äî Beautiful UI ¬∑ Supports English/Chinese ¬∑ Data saved locally in browser (localStorage)</footer>
  </div>

  <!-- ËÆæÁΩÆÊèêÈÜíÊ®°ÊÄÅÊ°Ü -->
  <div class="modal" id="reminderModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="reminderModalTitle">Set Reminder</div>
        <button class="close-modal" id="closeReminderModal">&times;</button>
      </div>
      <div class="form-group">
        <label for="reminderDateTime" data-t="reminderTimeLabel">Reminder Time</label>
        <input type="datetime-local" id="reminderDateTime" class="form-control">
      </div>
      <div style="display:flex;gap:10px;justify-content:flex-end">
        <button class="btn" id="cancelReminder" data-t="cancel">Cancel</button>
        <button class="btn" id="saveReminder" data-t="saveReminder">Save Reminder</button>
      </div>
    </div>
  </div>

  <!-- ÁºñËæëÁ¨îËÆ∞Ê®°ÊÄÅÊ°Ü -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="editModalTitle">Edit Note</div>
        <button class="close-modal" id="closeEditModal">&times;</button>
      </div>
      <div class="form-group">
        <label for="editTitle" data-t="titleLabel">Title</label>
        <input type="text" id="editTitle" class="form-control">
      </div>
      <div class="form-group">
        <label for="editContent" data-t="contentLabel">Content</label>
        <textarea id="editContent" rows="6" class="form-control"></textarea>
      </div>
      <div style="display:flex;gap:10px;justify-content:flex-end">
        <button class="btn" id="cancelEdit" data-t="cancel">Cancel</button>
        <button class="btn btn-success" id="saveEdit" data-t="saveEdit">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Base64 ÂØºÂá∫ÂØºÂÖ•Ê®°ÊÄÅÊ°Ü -->
  <div class="modal base64-modal" id="base64Modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="base64ModalTitle">Base64 Data</div>
        <button class="close-modal" id="closeBase64Modal">&times;</button>
      </div>
      
      <!-- Ê®°ÂºèÈÄâÊã©Âô® -->
      <div class="base64-mode-selector">
        <button class="mode-btn active" id="exportModeBtn" data-mode="export">Export</button>
        <button class="mode-btn" id="importModeBtn" data-mode="import">Import</button>
      </div>
      
      <!-- ÂØºÂá∫ÈÉ®ÂàÜ -->
      <div class="base64-section active" id="exportSection">
        <div class="form-group">
          <label for="base64ExportData" data-t="base64ExportLabel">Base64 Export Data</label>
          <textarea id="base64ExportData" placeholder="Base64 data will be automatically generated" readonly></textarea>
        </div>
        <div class="export-info" data-t="exportInfo">Export data is automatically generated when opening this section</div>
        <div class="base64-actions">
          <button class="btn btn-success" id="copyExport" data-t="copyExport">Copy to Clipboard</button>
          <button class="btn" id="refreshExport" data-t="refreshExport">Refresh Data</button>
        </div>
      </div>
      
      <!-- ÂØºÂÖ•ÈÉ®ÂàÜ -->
      <div class="base64-section" id="importSection">
        <div class="form-group">
          <label for="base64ImportData" data-t="base64ImportLabel">Base64 Import Data</label>
          <textarea id="base64ImportData" placeholder="Paste Base64 data here to import"></textarea>
        </div>
        <div class="base64-actions">
          <button class="btn" id="pasteImport" data-t="pasteImport">Paste from Clipboard</button>
          <button class="btn btn-success" id="importFromBase64" data-t="importFromBase64">Import Data</button>
        </div>
      </div>
      
      <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:16px;border-top:1px solid var(--border);padding-top:16px">
        <button class="btn" id="closeBase64" data-t="closeBase64">Close</button>
      </div>
    </div>
  </div>

  <script>
    const UI = {
      cn: {
        title: 'ÁÆÄÁ∫¶Á¨îËÆ∞',
        subtitle: 'ËΩªÈáè ¬∑ ÊîØÊåÅÊêúÁ¥¢ ¬∑ ÊèêÈÜí ¬∑ ‰∏≠Ëã±ÂàáÊç¢ ¬∑ ÊöóÈªë',
        help: 'ÊØèÊù°Á¨îËÆ∞‰ºö‰øùÂ≠òÂàõÂª∫Êó∂Èó¥ÔºåÂèØËÆæÁΩÆÊèêÈÜí',
        searchPlaceholder: 'ÊêúÁ¥¢Á¨îËÆ∞',
        newNote: 'Êñ∞Âª∫Á¨îËÆ∞',
        export: 'ÂØºÂá∫Êï∞ÊçÆ',
        import: 'ÂØºÂÖ•Êï∞ÊçÆ',
        save: '‰øùÂ≠ò',
        clear: 'Ê∏ÖÈô§',
        titlePlaceholder: 'Ê†áÈ¢ò',
        contentPlaceholder: 'ÂÜôÁÇπ‰ªÄ‰πà...',
        remindersTitle: 'ÊèêÈÜí‰∏≠ÂøÉ',
        infoTitle: 'ËØ¥Êòé',
        infoText: 'ÊîØÊåÅÊú¨Âú∞Â≠òÂÇ®ÔºåÊèêÈÜí‰ºöÂú®È°µÈù¢ÊâìÂºÄÊó∂Ê£ÄÊü•Âπ∂‰ΩøÁî®Ê°åÈù¢ÈÄöÁü•ÔºàÈúÄÂÖÅËÆ∏Ôºâ„ÄÇ',
        noReminders: 'ÊöÇÊó†ÊèêÈÜí',
        noNotes: 'ÊöÇÊó†Á¨îËÆ∞ÔºåÂàõÂª∫Á¨¨‰∏ÄÊù°Á¨îËÆ∞ÂºÄÂßã‰ΩøÁî®',
        deleteConfirm: 'Á°ÆËÆ§Âà†Èô§ËøôÊù°Á¨îËÆ∞Ôºü',
        deleteReminderConfirm: 'Á°ÆËÆ§Âà†Èô§Ëøô‰∏™ÊèêÈÜíÔºü',
        done: 'Ê†á‰∏∫ÂÆåÊàê',
        completed: 'Â∑≤ÂÆåÊàê',
        delete: 'Âà†Èô§',
        edit: 'ÁºñËæë',
        reminder: 'ÊèêÈÜí',
        noReminder: 'Êó†ÊèêÈÜí',
        setReminder: 'ËÆæÁΩÆÊèêÈÜí',
        editReminder: '‰øÆÊîπÊèêÈÜí',
        reminderModalTitle: 'ËÆæÁΩÆÊèêÈÜí',
        editModalTitle: 'ÁºñËæëÁ¨îËÆ∞',
        cancel: 'ÂèñÊ∂à',
        saveReminder: '‰øùÂ≠òÊèêÈÜí',
        saveEdit: '‰øùÂ≠ò‰øÆÊîπ',
        footer: 'Simple Notebook ‚Äî UI Á≤æÁæé ¬∑ ÊîØÊåÅ‰∏≠Ëã± ¬∑ Êú¨Âú∞Êï∞ÊçÆ‰øùÂ≠òÂú®ÊµèËßàÂô® (localStorage)',
        importSuccess: 'Êï∞ÊçÆÂØºÂÖ•ÊàêÂäüÔºÅ',
        importError: 'ÂØºÂÖ•Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂Ê†ºÂºè',
        reminderTimeLabel: 'ÊèêÈÜíÊó∂Èó¥',
        titleLabel: 'Ê†áÈ¢ò',
        contentLabel: 'ÂÜÖÂÆπ',
        notificationTip: 'ÊèêÁ§∫ÔºöÈ¶ñÊ¨°ËÆæÁΩÆÊèêÈÜíÊó∂‰ºöËØ∑Ê±ÇÈÄöÁü•ÊùÉÈôêÔºåËØ∑ÂÖÅËÆ∏ÊµèËßàÂô®ÂèëÈÄÅÊ°åÈù¢ÈÄöÁü•',
        totalNotes: 'ÊÄªÁ¨îËÆ∞',
        activeReminders: 'Ê¥ªË∑ÉÊèêÈÜí',
        completedNotes: 'Â∑≤ÂÆåÊàê',
        undoComplete: 'Êí§ÈîÄÂÆåÊàê',
        completedNotesSection: 'Â∑≤ÂÆåÊàêÁ¨îËÆ∞',
        base64Data: 'Base64 Êï∞ÊçÆ',
        base64ExportLabel: 'Base64 ÂØºÂá∫Êï∞ÊçÆ',
        base64ImportLabel: 'Base64 ÂØºÂÖ•Êï∞ÊçÆ',
        copyExport: 'Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø',
        refreshExport: 'Âà∑Êñ∞Êï∞ÊçÆ',
        pasteImport: '‰ªéÂâ™Ë¥¥ÊùøÁ≤òË¥¥',
        importFromBase64: 'ÂØºÂÖ•Êï∞ÊçÆ',
        closeBase64: 'ÂÖ≥Èó≠',
        base64ExportSuccess: 'Base64 ÂØºÂá∫Êï∞ÊçÆÂ∑≤ÁîüÊàêÔºÅ',
        base64ImportSuccess: 'Base64 ÂØºÂÖ•ÊàêÂäüÔºÅ',
        base64ImportError: 'Base64 ÂØºÂÖ•Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êï∞ÊçÆÊ†ºÂºè',
        copySuccess: 'Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ',
        pasteSuccess: 'Â∑≤‰ªéÂâ™Ë¥¥ÊùøÁ≤òË¥¥Êï∞ÊçÆÔºÅ',
        pasteError: 'Êó†Ê≥ï‰ªéÂâ™Ë¥¥ÊùøËØªÂèñÊï∞ÊçÆ',
        exportMode: 'ÂØºÂá∫',
        importMode: 'ÂØºÂÖ•',
        exportInfo: 'ÊâìÂºÄÊ≠§È°µÈù¢Êó∂Ëá™Âä®ÁîüÊàêÂØºÂá∫Êï∞ÊçÆ'
      },
      en: {
        title: 'Simple Notebook',
        subtitle: 'Lightweight ¬∑ Search ¬∑ Reminders ¬∑ Lang & Darkmode',
        help: 'Each note stores creation date. Set reminders.',
        searchPlaceholder: 'Search notes',
        newNote: 'New Note',
        export: 'Export Data',
        import: 'Import Data',
        save: 'Save',
        clear: 'Clear',
        titlePlaceholder: 'Title',
        contentPlaceholder: 'Write something...',
        remindersTitle: 'Reminders',
        infoTitle: 'Info',
        infoText: 'Supports local storage. Reminders are checked when page opens and use desktop notifications (requires permission).',
        noReminders: 'No reminders',
        noNotes: 'No notes yet, create your first note to get started',
        deleteConfirm: 'Confirm delete this note?',
        deleteReminderConfirm: 'Confirm delete this reminder?',
        done: 'Mark as done',
        completed: 'Completed',
        delete: 'Delete',
        edit: 'Edit',
        reminder: 'Reminder',
        noReminder: 'No reminder',
        setReminder: 'Set Reminder',
        editReminder: 'Edit Reminder',
        reminderModalTitle: 'Set Reminder',
        editModalTitle: 'Edit Note',
        cancel: 'Cancel',
        saveReminder: 'Save Reminder',
        saveEdit: 'Save Changes',
        footer: 'Simple Notebook ‚Äî Beautiful UI ¬∑ Supports English/Chinese ¬∑ Data saved locally in browser (localStorage)',
        importSuccess: 'Data imported successfully!',
        importError: 'Import failed, please check file format',
        reminderTimeLabel: 'Reminder Time',
        titleLabel: 'Title',
        contentLabel: 'Content',
        notificationTip: 'Tip: First time setting a reminder will request notification permission, please allow browser to send desktop notifications',
        totalNotes: 'Total Notes',
        activeReminders: 'Active Reminders',
        completedNotes: 'Completed',
        undoComplete: 'Undo Complete',
        completedNotesSection: 'Completed Notes',
        base64Data: 'Base64 Data',
        base64ExportLabel: 'Base64 Export Data',
        base64ImportLabel: 'Base64 Import Data',
        copyExport: 'Copy to Clipboard',
        refreshExport: 'Refresh Data',
        pasteImport: 'Paste from Clipboard',
        importFromBase64: 'Import Data',
        closeBase64: 'Close',
        base64ExportSuccess: 'Base64 export data generated!',
        base64ImportSuccess: 'Base64 import successful!',
        base64ImportError: 'Base64 import failed, please check data format',
        copySuccess: 'Copied to clipboard!',
        pasteSuccess: 'Data pasted from clipboard!',
        pasteError: 'Unable to read data from clipboard',
        exportMode: 'Export',
        importMode: 'Import',
        exportInfo: 'Export data is automatically generated when opening this section'
      }
    };

    const app = document.getElementById('app');
    const notesEl = document.getElementById('notes');
    const completedSection = document.getElementById('completedSection');
    const completedNotesList = document.getElementById('completedNotesList');
    const remindersEl = document.getElementById('reminders');
    const q = document.getElementById('q');
    const langBtn = document.getElementById('lang');
    const themeBtn = document.getElementById('theme');
    const datetimeEl = document.getElementById('datetime');
    const lunarEl = document.getElementById('lunar');
    const fileInput = document.getElementById('fileInput');
    const totalNotesEl = document.getElementById('totalNotes');
    const activeRemindersEl = document.getElementById('activeReminders');
    const completedNotesEl = document.getElementById('completedNotes');
    const reminderModal = document.getElementById('reminderModal');
    const reminderModalTitle = document.getElementById('reminderModalTitle');
    const reminderDateTime = document.getElementById('reminderDateTime');
    const closeReminderModal = document.getElementById('closeReminderModal');
    const cancelReminder = document.getElementById('cancelReminder');
    const saveReminder = document.getElementById('saveReminder');
    const editModal = document.getElementById('editModal');
    const editModalTitle = document.getElementById('editModalTitle');
    const editTitle = document.getElementById('editTitle');
    const editContent = document.getElementById('editContent');
    const closeEditModal = document.getElementById('closeEditModal');
    const cancelEdit = document.getElementById('cancelEdit');
    const saveEdit = document.getElementById('saveEdit');
    const base64Modal = document.getElementById('base64Modal');
    const base64ModalTitle = document.getElementById('base64ModalTitle');
    const exportModeBtn = document.getElementById('exportModeBtn');
    const importModeBtn = document.getElementById('importModeBtn');
    const exportSection = document.getElementById('exportSection');
    const importSection = document.getElementById('importSection');
    const base64ExportData = document.getElementById('base64ExportData');
    const base64ImportData = document.getElementById('base64ImportData');
    const copyExport = document.getElementById('copyExport');
    const refreshExport = document.getElementById('refreshExport');
    const pasteImport = document.getElementById('pasteImport');
    const importFromBase64 = document.getElementById('importFromBase64');
    const closeBase64Modal = document.getElementById('closeBase64Modal');
    const closeBase64 = document.getElementById('closeBase64');
    
    let notes = JSON.parse(localStorage.getItem('notes_v1') || '[]');
    let currentLang = app.getAttribute('data-lang') || 'en'; // ÈªòËÆ§ËÆæ‰∏∫Ëã±Êñá
    let theme = app.getAttribute('data-theme') || 'light';
    let currentNoteId = null;
    let currentBase64Mode = 'export';

    // ËØ∑Ê±ÇÈÄöÁü•ÊùÉÈôê
    function requestNotificationPermission() {
      if (!('Notification' in window)) {
        return;
      }
      
      if (Notification.permission === 'default') {
        Notification.requestPermission();
      }
    }

    function applyLang() {
      const pack = currentLang === 'cn' ? UI.cn : UI.en;
      
      // Êõ¥Êñ∞ÊâÄÊúâÂ∏¶ data-t Â±ûÊÄßÁöÑÂÖÉÁ¥†
      document.querySelectorAll('[data-t]').forEach(el => {
        const key = el.getAttribute('data-t');
        if (pack[key]) {
          el.textContent = pack[key];
        }
      });
      
      // Êõ¥Êñ∞ÊåâÈíÆÊñáÊú¨
      document.getElementById('newNote').textContent = pack.newNote;
      document.getElementById('export').textContent = pack.export;
      document.getElementById('import').textContent = pack.import;
      document.getElementById('base64Data').textContent = pack.base64Data;
      document.getElementById('save').textContent = pack.save;
      document.getElementById('clear').textContent = pack.clear;
      
      // Êõ¥Êñ∞Âç†‰ΩçÁ¨¶
      document.getElementById('title').placeholder = pack.titlePlaceholder;
      document.getElementById('content').placeholder = pack.contentPlaceholder;
      q.placeholder = pack.searchPlaceholder;
      
      // Êõ¥Êñ∞Ê®°ÊÄÅÊ°ÜÊ†áÈ¢ò
      reminderModalTitle.textContent = pack.reminderModalTitle;
      editModalTitle.textContent = pack.editModalTitle;
      base64ModalTitle.textContent = pack.base64Data;
      
      // Êõ¥Êñ∞ËØ≠Ë®ÄÊåâÈíÆ
      langBtn.textContent = currentLang === 'cn' ? 'EN' : '‰∏≠Êñá';
      
      // Êõ¥Êñ∞ÁªüËÆ°Ê†áÁ≠æ
      document.querySelectorAll('.stat-label').forEach((el, index) => {
        if (index === 0) el.textContent = pack.totalNotes;
        if (index === 1) el.textContent = pack.activeReminders;
        if (index === 2) el.textContent = pack.completedNotes;
      });
      
      // Êõ¥Êñ∞Base64Ê®°ÊÄÅÊ°ÜÊñáÊú¨
      exportModeBtn.textContent = pack.exportMode;
      importModeBtn.textContent = pack.importMode;
      copyExport.textContent = pack.copyExport;
      refreshExport.textContent = pack.refreshExport;
      pasteImport.textContent = pack.pasteImport;
      importFromBase64.textContent = pack.importFromBase64;
      closeBase64.textContent = pack.closeBase64;
    }

    function applyTheme() {
      document.documentElement.setAttribute('data-theme', theme);
      app.setAttribute('data-theme', theme);
      themeBtn.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    }

    function updateClock() {
      const now = new Date();
      datetimeEl.textContent = now.toLocaleString();
      lunarEl.textContent = (currentLang === 'cn' ? 'ÂÜúÂéÜ: ' : 'Lunar: ') + getLunarDay(now);
    }
    setInterval(updateClock, 1000);
    updateClock();

    function getLunarDay(d) {
      if (currentLang === 'en') {
        // Ëã±ÊñáÊ®°Âºè‰∏ãÊòæÁ§∫ÊòüÊúüÂá†
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        return days[d.getDay()];
      }
      
      try {
        const f = new Intl.DateTimeFormat('zh-CN-u-ca-chinese', {
          day: 'numeric',
          month: 'numeric'
        });
        const parts = f.formatToParts(d);
        const dayPart = parts.find(p => p.type === 'day')?.value;
        if (dayPart) return 'Âàù' + dayPart;
      } catch (e) {}
      const day = d.getDate();
      const map = ['Âàù‰∏Ä', 'Âàù‰∫å', 'Âàù‰∏â', 'ÂàùÂõõ', 'Âàù‰∫î', 'ÂàùÂÖ≠', 'Âàù‰∏É', 'ÂàùÂÖ´', 'Âàù‰πù', 'ÂàùÂçÅ', 'ÂçÅ‰∏Ä', 'ÂçÅ‰∫å', 'ÂçÅ‰∏â', 'ÂçÅÂõõ', 'ÂçÅ‰∫î', 'ÂçÅÂÖ≠', 'ÂçÅ‰∏É', 'ÂçÅÂÖ´', 'ÂçÅ‰πù', '‰∫åÂçÅ', 'Âªø‰∏Ä', 'Âªø‰∫å', 'Âªø‰∏â', 'ÂªøÂõõ', 'Âªø‰∫î', 'ÂªøÂÖ≠', 'Âªø‰∏É', 'ÂªøÂÖ´', 'Âªø‰πù', '‰∏âÂçÅ'];
      return map[(day - 1) % 30] || 'Âàù?';
    }

    function updateStats() {
      const total = notes.length;
      const active = notes.filter(n => n.remindAt && !n.done).length;
      const completed = notes.filter(n => n.done).length;
      
      totalNotesEl.textContent = total;
      activeRemindersEl.textContent = active;
      completedNotesEl.textContent = completed;
    }

    function saveNotes() {
      localStorage.setItem('notes_v1', JSON.stringify(notes));
      renderNotes();
      renderCompletedNotes();
      renderReminders();
      updateStats();
    }

    function createNote(t, c, remindAt) {
      const n = {
        id: Date.now(),
        title: t || (currentLang === 'cn' ? '(Êó†Ê†áÈ¢ò)' : '(No Title)'),
        content: c || '',
        createdAt: new Date().toISOString(),
        remindAt: remindAt || null,
        done: false,
        _notified: false
      };
      notes.unshift(n);
      saveNotes();
      return n;
    }

    function updateNote(id, title, content) {
      const note = notes.find(n => n.id === id);
      if (note) {
        note.title = title;
        note.content = content;
        saveNotes();
      }
    }

    function deleteNote(id) {
      notes = notes.filter(x => x.id !== id);
      saveNotes();
    }

    function deleteReminder(id) {
      const note = notes.find(x => x.id === id);
      if (note) {
        note.remindAt = null;
        saveNotes();
      }
    }

    function setReminder(id, remindAt) {
      const note = notes.find(x => x.id === id);
      if (note) {
        note.remindAt = remindAt;
        note._notified = false;
        saveNotes();
        
        // Â¶ÇÊûúËÆæÁΩÆ‰∫ÜÊèêÈÜí‰ΩÜÈÄöÁü•ÊùÉÈôêÊú™ËÆæÁΩÆÔºåËØ∑Ê±ÇÊùÉÈôê
        if (remindAt && Notification.permission === 'default') {
          requestNotificationPermission();
        }
      }
    }

    function toggleDone(id) {
      const it = notes.find(x => x.id === id);
      if (it) it.done = !it.done;
      saveNotes();
    }

    function openReminderModal(noteId) {
      currentNoteId = noteId;
      const note = notes.find(n => n.id === noteId);
      const pack = currentLang === 'cn' ? UI.cn : UI.en;
      
      if (note && note.remindAt) {
        reminderModalTitle.textContent = pack.editReminder;
        reminderDateTime.value = formatDateTimeLocal(new Date(note.remindAt));
      } else {
        reminderModalTitle.textContent = pack.setReminder;
        // ËÆæÁΩÆÈªòËÆ§Êó∂Èó¥‰∏∫ÂΩìÂâçÊó∂Èó¥+1Â∞èÊó∂
        const defaultTime = new Date(Date.now() + 60 * 60 * 1000);
        reminderDateTime.value = formatDateTimeLocal(defaultTime);
      }
      
      reminderModal.style.display = 'flex';
    }

    function openEditModal(noteId) {
      currentNoteId = noteId;
      const note = notes.find(n => n.id === noteId);
      
      if (note) {
        editTitle.value = note.title;
        editContent.value = note.content;
        editModal.style.display = 'flex';
      }
    }

    function closeReminderModalFunc() {
      reminderModal.style.display = 'none';
      currentNoteId = null;
    }

    function closeEditModalFunc() {
      editModal.style.display = 'none';
      currentNoteId = null;
    }

    function formatDateTimeLocal(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');
      
      return `${year}-${month}-${day}T${hours}:${minutes}`;
    }

    function renderNotes(filter = '') {
      notesEl.innerHTML = '';
      const activeNotes = notes.filter(n => !n.done && (n.title + ' ' + n.content).toLowerCase().includes(filter.toLowerCase()));

      if (activeNotes.length === 0) {
        const pack = currentLang === 'cn' ? UI.cn : UI.en;
        notesEl.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M12 11v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <div>${pack.noNotes}</div>
          </div>
        `;
        return;
      }

      for (const n of activeNotes) {
        const el = document.createElement('div');
        el.className = `note`;
        
        const pack = currentLang === 'cn' ? UI.cn : UI.en;
        const remindDisplay = n.remindAt ? 
          `<span class='reminderTime'>${pack.reminder}: ${(new Date(n.remindAt)).toLocaleString()}</span>` : 
          pack.noReminder;
          
        el.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:start">
            <div class="note-title" style="font-weight:700;font-size:16px;color:var(--text)">${escapeHtml(n.title)}</div>
            <div style="text-align:right">
              <div class="pill">${new Date(n.createdAt).toLocaleString()}</div>
            </div>
          </div>
          <div style="margin-top:10px;color:var(--text-secondary);font-size:14px">${escapeHtml(n.content).replace(/\n/g, '<br/>')}</div>
          <div style="margin-top:12px;display:flex;gap:10px;align-items:center" class="meta">
            <div class="pill">${remindDisplay}</div>
            <div class="pill">ID:${n.id}</div>
            <div style="flex:1"></div>
            <button class="btn btn-warning" data-action="set-reminder" data-id="${n.id}">${pack.setReminder}</button>
            <button class="btn btn-success" data-action="edit" data-id="${n.id}">${pack.edit}</button>
            <button class="btn" data-action="done" data-id="${n.id}">${pack.done}</button>
            <button class="btn btn-danger" data-action="delete" data-id="${n.id}">${pack.delete}</button>
          </div>
        `;
        notesEl.appendChild(el);
      }
    }

    function renderCompletedNotes(filter = '') {
      const completedNotes = notes.filter(n => n.done && (n.title + ' ' + n.content).toLowerCase().includes(filter.toLowerCase()));
      
      if (completedNotes.length === 0) {
        completedSection.style.display = 'none';
        return;
      }
      
      completedSection.style.display = 'block';
      completedNotesList.innerHTML = '';
      
      const pack = currentLang === 'cn' ? UI.cn : UI.en;
      
      // Êõ¥Êñ∞Â∑≤ÂÆåÊàêÁ¨îËÆ∞Âå∫ÂüüÁöÑÊ†áÈ¢ò
      document.querySelector('#completedSection .section-title').textContent = pack.completedNotesSection;
      
      for (const n of completedNotes) {
        const el = document.createElement('div');
        el.className = `completed-note`;
        
        const remindDisplay = n.remindAt ? 
          `<span class='reminderTime'>${pack.reminder}: ${(new Date(n.remindAt)).toLocaleString()}</span>` : 
          pack.noReminder;
          
        el.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:start">
            <div class="note-title" style="font-weight:700;font-size:16px;color:var(--text)">${escapeHtml(n.title)}</div>
            <div style="text-align:right">
              <div class="pill">${new Date(n.createdAt).toLocaleString()}</div>
            </div>
          </div>
          <div style="margin-top:10px;color:var(--text-secondary);font-size:14px">${escapeHtml(n.content).replace(/\n/g, '<br/>')}</div>
          <div style="margin-top:12px;display:flex;gap:10px;align-items:center" class="meta">
            <div class="pill">${remindDisplay}</div>
            <div class="pill">ID:${n.id}</div>
            <div style="flex:1"></div>
            <button class="btn btn-success" data-action="undo-done" data-id="${n.id}">${pack.undoComplete}</button>
            <button class="btn btn-danger" data-action="delete" data-id="${n.id}">${pack.delete}</button>
          </div>
        `;
        completedNotesList.appendChild(el);
      }
    }

    function renderReminders() {
      remindersEl.innerHTML = '';
      const now = new Date();
      const upcoming = notes
        .filter(n => n.remindAt && !n.done)
        .sort((a, b) => new Date(a.remindAt) - new Date(b.remindAt));
        
      const pack = currentLang === 'cn' ? UI.cn : UI.en;
      
      if (upcoming.length === 0) {
        remindersEl.innerHTML = `<div style="color:var(--muted);text-align:center;padding:20px">${pack.noReminders}</div>`;
        return;
      }
      
      for (const n of upcoming) {
        const el = document.createElement('div');
        const when = new Date(n.remindAt);
        const isAlert = when <= now;
        
        el.className = `reminder-item ${isAlert ? 'alert' : ''}`;
        el.innerHTML = `
          <div class="reminder-indicator ${isAlert ? 'alert' : ''}"></div>
          <div style="flex:1">
            <div style="font-weight:600;font-size:14px">${escapeHtml(n.title)}</div>
            <div class="${isAlert ? 'reminderAlert' : 'reminderTime'}" style="font-size:12px">${when.toLocaleString()}</div>
          </div>
          <button class="btn btn-danger" data-action="delete-reminder" data-id="${n.id}" style="padding:6px;font-size:12px">
            ${pack.delete}
          </button>
        `;
        remindersEl.appendChild(el);
      }
    }

    function checkReminders() {
      const now = new Date();
      let hasActiveReminders = false;
      
      for (const n of notes) {
        if (n.remindAt && !n.done && !n._notified) {
          const t = new Date(n.remindAt);
          if (t <= now) {
            notify(n);
            n._notified = true;
            hasActiveReminders = true;
          }
        }
      }
      
      if (hasActiveReminders) {
        saveNotes();
      }
      
      renderReminders();
    }
    
    setInterval(checkReminders, 30000);
    checkReminders();

    function notify(n) {
      const pack = currentLang === 'cn' ? UI.cn : UI.en;
      const text = (currentLang === 'cn') ? `ÊèêÈÜí: ${n.title}` : `Reminder: ${n.title}`;
      
      if (window.Notification && Notification.permission === 'granted') {
        new Notification(text, {
          body: n.content.substring(0, 120),
          icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üìù</text></svg>',
          tag: `note-${n.id}`
        });
      } else {
        // Â¶ÇÊûúÈÄöÁü•ÊùÉÈôêË¢´ÊãíÁªùÔºå‰ΩøÁî®alert‰Ωú‰∏∫Â§áÁî®
        alert(text + '\n' + n.content);
      }
    }

    function escapeHtml(s) {
      return (s || '').replace(/[&<>"']/g, c => ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      }[c]));
    }

    function exportAllNotes() {
      const data = JSON.stringify(notes, null, 2);
      const blob = new Blob([data], {
        type: 'application/json'
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'notes_backup.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function importNotes(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const importedNotes = JSON.parse(e.target.result);
          if (Array.isArray(importedNotes)) {
            notes = importedNotes;
            saveNotes();
            const pack = currentLang === 'cn' ? UI.cn : UI.en;
            alert(pack.importSuccess);
          } else {
            throw new Error('Invalid format');
          }
        } catch (error) {
          const pack = currentLang === 'cn' ? UI.cn : UI.en;
          alert(pack.importError);
        }
      };
      reader.readAsText(file);
    }

    // Base64 ÂäüËÉΩ
    function openBase64Modal() {
      base64Modal.style.display = 'flex';
      // ÈªòËÆ§ÊòæÁ§∫ÂØºÂá∫Ê®°ÂºèÔºåÂπ∂Ëá™Âä®ÁîüÊàêÊï∞ÊçÆ
      switchBase64Mode('export');
      generateBase64Export(); // Ëá™Âä®ÁîüÊàêÂØºÂá∫Êï∞ÊçÆ
    }

    function switchBase64Mode(mode) {
      currentBase64Mode = mode;
      
      // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
      exportModeBtn.classList.toggle('active', mode === 'export');
      importModeBtn.classList.toggle('active', mode === 'import');
      
      // Êõ¥Êñ∞ÂÜÖÂÆπÂå∫Âüü
      exportSection.classList.toggle('active', mode === 'export');
      importSection.classList.toggle('active', mode === 'import');
      
      // Â¶ÇÊûúÊòØÂØºÂá∫Ê®°ÂºèÔºåËá™Âä®ÁîüÊàêÊï∞ÊçÆ
      if (mode === 'export') {
        generateBase64Export();
      } else {
        // Ê∏ÖÁ©∫ÂØºÂÖ•Âå∫Âüü
        base64ImportData.value = '';
      }
    }

    function generateBase64Export() {
      const data = JSON.stringify(notes);
      const base64 = btoa(unescape(encodeURIComponent(data)));
      base64ExportData.value = base64;
      
      // Ëá™Âä®ÈÄâ‰∏≠ÊñáÊú¨‰ª•‰æøÁî®Êà∑Â§çÂà∂
      base64ExportData.select();
    }

    function copyBase64ToClipboard() {
      base64ExportData.select();
      document.execCommand('copy');
      
      const pack = currentLang === 'cn' ? UI.cn : UI.en;
      alert(pack.copySuccess);
    }

    function refreshBase64Export() {
      generateBase64Export();
      const pack = currentLang === 'cn' ? UI.cn : UI.en;
      alert(pack.base64ExportSuccess);
    }

    function pasteFromClipboard() {
      navigator.clipboard.readText().then(text => {
        base64ImportData.value = text;
        const pack = currentLang === 'cn' ? UI.cn : UI.en;
        alert(pack.pasteSuccess);
      }).catch(err => {
        const pack = currentLang === 'cn' ? UI.cn : UI.en;
        alert(pack.pasteError);
      });
    }

    function importFromBase64Data() {
      try {
        const base64 = base64ImportData.value.trim();
        if (!base64) return;
        
        const jsonString = decodeURIComponent(escape(atob(base64)));
        const importedNotes = JSON.parse(jsonString);
        
        if (Array.isArray(importedNotes)) {
          notes = importedNotes;
          saveNotes();
          base64Modal.style.display = 'none';
          const pack = currentLang === 'cn' ? UI.cn : UI.en;
          alert(pack.base64ImportSuccess);
        } else {
          throw new Error('Invalid format');
        }
      } catch (error) {
        const pack = currentLang === 'cn' ? UI.cn : UI.en;
        alert(pack.base64ImportError);
      }
    }

    // Event Listeners
    document.getElementById('save').addEventListener('click', () => {
      const t = document.getElementById('title').value.trim();
      const c = document.getElementById('content').value.trim();
      const r = document.getElementById('remindAt').value || null;
      createNote(t, c, r);
      if (r && Notification && Notification.permission !== 'granted') {
        requestNotificationPermission();
      }
      document.getElementById('title').value = '';
      document.getElementById('content').value = '';
      document.getElementById('remindAt').value = '';
    });

    document.getElementById('newNote').addEventListener('click', () => document.getElementById('title').focus());

    document.getElementById('export').addEventListener('click', exportAllNotes);

    document.getElementById('import').addEventListener('click', () => fileInput.click());
    
    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        importNotes(e.target.files[0]);
        e.target.value = ''; // Reset file input
      }
    });

    // Base64 Êï∞ÊçÆÊåâÈíÆ‰∫ã‰ª∂
    document.getElementById('base64Data').addEventListener('click', openBase64Modal);

    // Base64 Ê®°ÊÄÅÊ°Ü‰∫ã‰ª∂
    exportModeBtn.addEventListener('click', () => switchBase64Mode('export'));
    importModeBtn.addEventListener('click', () => switchBase64Mode('import'));
    copyExport.addEventListener('click', copyBase64ToClipboard);
    refreshExport.addEventListener('click', refreshBase64Export);
    pasteImport.addEventListener('click', pasteFromClipboard);
    importFromBase64.addEventListener('click', importFromBase64Data);
    closeBase64Modal.addEventListener('click', () => base64Modal.style.display = 'none');
    closeBase64.addEventListener('click', () => base64Modal.style.display = 'none');

    notesEl.addEventListener('click', e => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const id = Number(btn.dataset.id);
      const pack = currentLang === 'cn' ? UI.cn : UI.en;
      
      if (btn.dataset.action === 'delete') {
        if (confirm(pack.deleteConfirm)) {
          deleteNote(id);
        }
      }
      if (btn.dataset.action === 'done') {
        toggleDone(id);
      }
      if (btn.dataset.action === 'set-reminder') {
        openReminderModal(id);
      }
      if (btn.dataset.action === 'edit') {
        openEditModal(id);
      }
    });

    completedNotesList.addEventListener('click', e => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const id = Number(btn.dataset.id);
      const pack = currentLang === 'cn' ? UI.cn : UI.en;
      
      if (btn.dataset.action === 'delete') {
        if (confirm(pack.deleteConfirm)) {
          deleteNote(id);
        }
      }
      if (btn.dataset.action === 'undo-done') {
        toggleDone(id);
      }
    });

    remindersEl.addEventListener('click', e => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const id = Number(btn.dataset.id);
      const pack = currentLang === 'cn' ? UI.cn : UI.en;
      
      if (btn.dataset.action === 'delete-reminder') {
        if (confirm(pack.deleteReminderConfirm)) {
          deleteReminder(id);
        }
      }
    });

    // ÊèêÈÜíÊ®°ÊÄÅÊ°Ü‰∫ã‰ª∂
    closeReminderModal.addEventListener('click', closeReminderModalFunc);
    cancelReminder.addEventListener('click', closeReminderModalFunc);
    
    saveReminder.addEventListener('click', () => {
      if (currentNoteId && reminderDateTime.value) {
        setReminder(currentNoteId, reminderDateTime.value);
        closeReminderModalFunc();
      }
    });

    // ÁºñËæëÊ®°ÊÄÅÊ°Ü‰∫ã‰ª∂
    closeEditModal.addEventListener('click', closeEditModalFunc);
    cancelEdit.addEventListener('click', closeEditModalFunc);
    
    saveEdit.addEventListener('click', () => {
      if (currentNoteId && editTitle.value.trim()) {
        updateNote(currentNoteId, editTitle.value.trim(), editContent.value.trim());
        closeEditModalFunc();
      }
    });

    // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
    window.addEventListener('click', (e) => {
      if (e.target === reminderModal) {
        closeReminderModalFunc();
      }
      if (e.target === editModal) {
        closeEditModalFunc();
      }
      if (e.target === base64Modal) {
        base64Modal.style.display = 'none';
      }
    });

    q.addEventListener('input', () => {
      renderNotes(q.value);
      renderCompletedNotes(q.value);
    });
    
    document.getElementById('clear').addEventListener('click', () => {
      q.value = '';
      renderNotes();
      renderCompletedNotes();
    });

    langBtn.addEventListener('click', () => {
      currentLang = currentLang === 'cn' ? 'en' : 'cn';
      app.setAttribute('data-lang', currentLang);
      applyLang();
      renderNotes(q.value);
      renderCompletedNotes(q.value);
      renderReminders();
    });

    themeBtn.addEventListener('click', () => {
      theme = theme === 'dark' ? 'light' : 'dark';
      app.setAttribute('data-theme', theme);
      applyTheme();
    });

    // Initialize
    applyLang();
    applyTheme();
    renderNotes();
    renderCompletedNotes();
    renderReminders();
    updateStats();
    setTimeout(checkReminders, 2000);
  </script>
</body>
</html>
